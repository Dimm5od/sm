<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'none';
            manifest-src 'self';
            script-src 'self' 'nonce-c13d9af436';
             connect-src https://cptp.exima-online.net/smemo/ https://sm2.autocrash.com.ua/ https://sm3.autocrash.com.ua/ https://dimm5od.github.io/sm/;
            style-src 'self';
            img-src 'self' data: blob:;
            base-uri 'none';
            object-src 'none';">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="main.css?v6">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3367D6">
    <link rel="apple-touch-icon" href="icons/icon-512.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>My Notes</title>
</head>
<body>

<div class="container">

    <!-- Поле с информацией о логине, показывается после авторизации-->
    <div id="loginInfo" class="hidden flex">
        <div class="left-buttons">
            <button id="btnNew" class="small">Добавить запись</button>
            <button id="btnTextArea" class="small align-left hidden">#</button>
        </div>
        <div class="align-right">
            <div class="logoutContainer">ID: <a href="#" id="lnkLogout"><span id="secretIcons"></span></a></div>
            <span class="server-name" id="server-name"></span>
        </div>
    </div>

    <!-- Форма авторизации -->
    <div id="loginArea" class="hidden">

        <div class="flex">
            <h2>SMemo - Secure Memo HTML client</h2>
            <div class="align-right">
                <button class="normal hidden" id="btnLogout">Logout </button>
            </div>
        </div>

        <form id="loginForm">

            <div><label for="passphrase">Секретная фраза: <span id="secretIcons2"></span></label></div>
            <div class="progress-container">
                <div class="progress-bar" id="progress"></div>
            </div>
            <div class="password-wrapper">
                <input type="password" id="passphrase" placeholder="Введите вашу секретную фразу" required
                       value=""><span class="password-toggle" id="toggle" data-toggle="passphrase">&#128065;</span>
            </div>
            <div>[ <a href="#" id="lnkSettings">Настройки</a> ]</div>

            <!-- Блок настроек -->
            <div id="settingsArea" class="hidden">
                <br>
                <!-- Список серверов -->
                <label for="apiServer">Выберите сервер:</label>
                <select id="apiServer">
                    <option data-type="master" value="https://cptp.exima-online.net/smemo/api.php" selected>Основной
                        сервер
                    </option>
                    <option data-type="slave" value="https://sm3.autocrash.com.ua/api.php">Резервный UkrLine</option>
                    <option data-type="slave" value="https://sm2.autocrash.com.ua/api.php">Резервный xen2</option>
                </select>
                <input type="checkbox" id="unsafePassphrase" value="1" class="small"> <label for="unsafePassphrase">Разрешить
                простые фразы</label><br>
                <span class="description">Отключить требование сложности секретной фразы более 80%. Настоятельно НЕ рекомендуется!</span>
                <br>
                <input type="checkbox" id="savePassphrase" value="1" class="small"> <label for="savePassphrase">Сохранить
                секретную фразу</label><br>
                <span class="description">Фраза будет храниться в зашифрованном виде в localStorage браузера, пока вы не нажмете кнопку Logout! Для шифрования используется системная биометрия</span>
                <br>
                <input type="checkbox" id="enableTools" value="1" class="small"> <label for="enableTools">Включить Text
                Tools</label><br>
                <span class="description">Включает возможность шифрования / расшифровки пользовательского текста с произвольной парольной фразой, для внешнего использования, не связанного с SMemo</span>
                <br>
                <input type="checkbox" id="enableDebug" value="1" class="small"> <label for="enableDebug">Включить
                отладку</label><br>
                <span class="description">Скрипт будет показывать все запросы к серверу его ответы, а так же выводить отладочную информацию в консоль. Не рекомендуется для обычного использования.</span>

            </div>

            <button type="submit" class="actionBtn">Применить / Войти</button>
        </form>
    </div>

    <div id="actionsArea" class="hidden">
        <button id="passwdBtn" type="button" disabled>Изменить парольную фразу</button>
        <br>
        <button id="exportBtn" type="button" disabled>Экспорт данных</button>
        <br>
        <button id="importBtn" type="button" disabled>Импорт данных</button>
        <br>
        <button id="backupBtn" type="button" disabled>Скачать бекап</button>
        <br>
        <button id="restoreBtn" type="button" disabled>Восстановить бекап</button>
        <br>
        <button id="terminateAccountBtn" type="button" class="color-red" disabled>Удалить все данные</button>
        <br>
    </div>

    <div id="exportArea" class="hidden">
        <h3>Результаты экспорта</h3>
        <label for="exportTextArea"><span class="description">Скопируйте и сохраните ваши данные на свое устройство для дальнейшего использования</span></label>
        <textarea id="exportTextArea" rows="15"></textarea>
        <br>
        <button id="copyExportBtn" type="button" class="small">Скопировать в буфер</button>
        <button id="saveExportBtn" type="button" class="small actionBtn">Сохранить в файл</button>
        <br>
        <button id="closeExportBtn" type="button">Вернуться в настройки</button>
        <br><br>
    </div>

    <div id="importArea" class="hidden">
        <h3>Импорт данных</h3>
        <label for="importTextArea"><span class="description">Вставьте текст в формате JSON. Должны присутствовать поля title, tags, text. Остальные поля будут проигнорированы. Записи будут ДОБАВЛЕНЫ к вашим существующим.</span></label>
        <textarea id="importTextArea" rows="15">[
  {
    "title": "Заголовок заметки",
    "tags": "тег1, тег2",
    "text": "Текст заметки"
  },
    {
    "title": "Вторая заметки",
    "tags": "тег2, тест",
    "text": "Содержимое второй заметки"
  }
 ]</textarea>
        <pre id="importLog" class="hidden"></pre>
        <div class="import-controls">
            <button id="pasteImportBtn" type="button" class="small">Вставить из буфера</button>
            или <input type="file" id="fileInput" accept=".txt,.json">
        </div>
        <button id="doImportBtn" class="actionBtn" type="button">Выполнить импорт</button>
        <button id="closeImportBtn" type="button">Вернуться в настройки</button>
        <br><br>
    </div>

    <div id="restoreArea" class="hidden">
        <h3>Восстановление бекапа</h3>
        <div class="description">Внимание: восстановление <span class="color-red">удалит все существующие данные</span>
            и заменит их данными из выбранного вами бекапа!<br></div>
        <div id="backupInfo">файл бекапа не выбран</div>
        <input type="file" id="fileInputBackup" accept=".gz">
        <button id="doRestoreBtn" type="button" disabled>Восстановить бекап</button>
        <button id="doDecryptBtn" type="button" disabled>Расшифровать и экспортировать данные</button>
        <button id="closeRestoreBtn" type="button">Вернуться в настройки</button>
        <br><br>
    </div>


    <div id="textArea" class="hidden">
        <h3>Шифрование текста</h3>
        <label for="textPassphrase">Секретная фраза: <span id="textAreaIcons"></span></label>
        <div class="password-wrapper">
            <input type="text" id="textPassphrase" placeholder="Введите секретную фразу" value="">
        </div>
        <label for="encodeTextArea"><span
                class="description">Вставьте текст, который нужно зашифровать / расшифровать</span></label>
        <textarea id="encodeTextArea" rows="15"></textarea>
        <div class="import-controls">
            <button id="pasteTextBtn" type="button" class="small">Вставить</button>
            <button id="copyTextBtn" type="button" class="small">Скопировать</button>
            <button id="clearTextBtn" type="button" class="small">Очистить</button>
        </div>
        <div class="flex gap">
            <button id="doEncodeTextBtn" type="button" class="width50">Зашифровать</button>
            <button id="doDecodeTextBtn" type="button" class="width50">Расшифровать</button>
        </div>
        <button id="closeTextBtn" type="button">Вернуться</button>
        <br><br>
    </div>

    <!-- форма поиска, показывается все время после авторизации -->
    <div id="searchArea" class="hidden">
        <form id="searchForm" autocomplete="off">
            <label for="searchQuery"></label><input type="text" id="searchQuery" placeholder="Поиск..." required
                                                    enterkeyhint="search"/>
            <button type="submit" id="searchBtn">Искать</button>
        </form>
        <div id="searchResultsList"></div>
    </div>

    <div id="viewArea" class="hidden">
        <div id="viewActionButtons" class="align-right">
            <button id="btnActionClose" class="small">Закрыть</button>
            <button id="btnActionEdit" class="small">Правка</button>
            <button id="btnActionDelete" class="color-red small">Удалить</button>
        </div>
        <div class="page-header">
            <div id="viewDate" class="noteDate"></div>
            <h2 id="viewTitle"></h2>
        </div>
        <div id="viewContent"></div>
        <div id="viewTags"></div>
    </div>

    <div id="editArea" class="hidden">
        <h3 id="editTitle">Новая запись</h3>
        <form id="editForm" autocomplete="off">
            <input type="hidden" id="editId">
            <label>Заголовок:<br><input type="text" id="editTitleInput" tabindex="1"></label>
            <label>Теги:<br><input type="text" id="editTagsInput" tabindex="2"></label>
            <label>Текст:<br><textarea id="editTextInput" tabindex="3"></textarea></label>
            <button type="submit" class="normal actionBtn" tabindex="4">Сохранить <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"></path><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"></path></svg></button>
            <button type="button" class="normal" id="btnCancelEdit" tabindex="5">Отменить </button>
        </form>
    </div>

    <div id="passwdArea" class="hidden">
        <h2>Изменение секретной фразы</h2>
        <label for="passphrase1">Старая фраза: <span id="secretIcons3"></span></label>
        <div class="password-wrapper">
            <input type="password" id="passphrase1" placeholder="Введите старую фразу" required
                   value="" readonly><span
                class="password-toggle" id="toggle3" data-toggle="passphrase1">&#128065;</span>
        </div>

        <div><label for="passphrase2">Новая фраза: <span id="secretIcons4"></span></label></div>
        <div class="progress-container">
            <div class="progress-bar" id="progress2"></div>
        </div>
        <div class="password-wrapper">
            <input type="password" id="passphrase2" placeholder="Введите новую фразу" required
                   value=""><span
                class="password-toggle" id="toggle4" data-toggle="passphrase2">&#128065;</span>
        </div>
        <button type="button" id="btnDoPasswd" class="actionBtn">Изменить секретную фразу</button>
        <button type="button" id="btnCancelPasswd">Отменить</button>
    </div>

    <div id="helpArea" class="hidden">
        <div class="align-right">
            <button class="normal" id="closeHelpBtn">Закрыть справку</button>
        </div>
        <h2>SMemo - Secure Memo HTML client</h2>
        Версия <b>v.<span id="version">0</span></b><br>
        Авторские права &copy; 2025 Dmytro Biletskyi (Dimm5od) <a href="https://github.com/dimm5od/sm" target="_blank">https://github.com/dimm5od/sm</a><br>
        Лицензия: Open Source (<a href="https://www.gnu.org/licenses/old-licenses/gpl-2.0.ru.html" target="_blank">GNU
        GPL-2.0 license</a>)<br>
        <hr>
        <b>Secure Memo</b> - механизм для удобного и безопасного online хранения текстовых заметок. Содержимое заметок
        надежно шифруется с помощью криптостойкого алгоритма AES-256-GCM 256 битным ключом, созданным на основе
        секретной парольной фразы пользователя. Все операции шифрования / расшифровки и обработки данных происходят на
        стороне клиента, и незашифрованные данные никогда не покидают браузер пользователя. Зашифрованные данные
        хранятся онлайн, в удаленной MySQL базе. Управление данными происходит через API запросы.
    </div>

    <b id="debugToggle" class="hidden">Отладка ▼</b>
    <div id="debug" class="hidden"></div>

</div>
<footer>SMemo &copy; 2005 | <a href="#" id="btnHelpArea">About &amp; FAQ</a></footer>
<script src="main.js"></script>
</body>
</html>
